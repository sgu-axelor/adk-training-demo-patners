<?xml version="1.0" encoding="UTF-8"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_5.0.xsd">

	<grid model="com.axelor.partner.db.Partner" title="Partners"
		name="partner-grid">
		<toolbar>
			<button name="show" onClick="action-show-partners"
				icon="fa-file-pdf-o" />
		</toolbar>
		<field name="fullName" />
		<field name="email" />
	</grid>

	<cards name="partner-card" model="com.axelor.partner.db.Partner"
		title="Partners">
		<field name="fullName" />
		<field name="emailAdd" />
		<field name="address" />
		<field name="hasImage" />
		<template><![CDATA[
      <div class="span4 card-image">
        <img ng-if="hasImage" ng-src="{{$image(null, 'image')}}">
        <img ng-if="!hasImage" src="img/user.png">
        <strong>{{fullName}}</strong><br>
      </div>
      <div class="span8">
        <address>
			{{address.street}} {{address.area}}<br>
        	{{address.city}}<span ng-if="address.state">, {{address.state}}</span><br>
        	<span ng-if="address.zip">{{address.zip}}<br></span>
        	<strong><abbr ng-if="emailAdd" title="Email">E:</abbr> {{emailAdd}}<br></strong>
        </address>
      </div>
    ]]></template>
	</cards>

	<tree name="partner-tree" title="Partner-Address-Company">

		<!-- define tree columns -->
		<column name="title" type="string" />
		<column name="street" type="string" />

		<!-- define 1st level node -->
		<node model="com.axelor.partner.db.Partner"
			onClick="partner.showallpartner.tree">
			<field name="fullName" as="title" />
		</node>

		<!-- define 2nd level node -->
		<node model="com.axelor.partner.db.Address" parent="partner"
			onClick="partner.showalladdress.tree" draggable="true">
			<field name="street" as="street" />
		</node>

	</tree>

	<kanban name="partner-kanban" sequenceBy="companyassociations"
		model="com.axelor.partner.db.Partner" columnBy="agreementPeriod"
		title="Partners" limit="5">
		<field name="fullName" />
		<field name="hasImage" />
		<field name="startdate" />
		<field name="seeCompany" />
		<hilite color="success" if="seeCompany>=5" />
		<hilite color="danger" if="seeCompany==0" />
		<hilite color="danger" if="seeCompany>2" />
		<hilite color="info" if="seeCompany>=1" />

		<template><![CDATA[
			<h4>{{fullName}}</h4>
    		{{seeCompany}}
    		<img ng-if="hasImage" ng-src="{{$image(null, 'image')}}">
        	<img ng-if="!hasImage" src="img/user.png">
    		<div class="card-footer">
      			<i class='fa fa-clock-o'></i> <span>{{startdate}}</span>
    		</div>
		]]></template>
	</kanban>

	<selection name="agreementPeriod-selection-list">
		<option value="5">5 Years</option>
		<option value="10">10 Years</option>
		<option value="15">15 Years</option>
	</selection>

	<form model="com.axelor.partner.db.Partner" title="Partner"
		name="partner-form" onSave="action-group-onsave"
		onNew="default-fname,action-attr-lname-readonly-false"
		onLoad="action-export-on">
		<toolbar>
			<button name="show"
				onClick="action-set-parameter,action-show-partner"
				icon="fa-file-pdf-o" />
		</toolbar>
		<panel sidebar="true" colSpan="4" title="Photo">
			<field name="image" showTitle="false" colSpan="12"
				widget="image" />
		</panel>
		<panel sidebar="true">
			<button name="btexport" icon="fa-download" title="Export"
				onClick="action-export-xml" readonly="true" />
		</panel>
		<panel title="Personal">
			<field name="fullName" title="Name" readonly="false"
				colSpan="12">
				<editor x-show-titles="false">
					<field name="firstName" colSpan="5" />
					<field name="lastName" colSpan="5" readonly="true" />
				</editor>
			</field>
		</panel>

		<panel title="Contacts">
			<field name="email" canSelect="false" domain="self.email= :email">
				<editor layout="table"><!-- x-show-titles="false" -->
					<field name="emailId" />
				</editor>
			</field>
			<field name="addresses" colSpan="12" css="address-list">
				<viewer><![CDATA[ <address> {{record.street}} {{record.area}}<br> {{record.city}}, {{record.state}} 
										- {{record.zip}}<br> {{record.country.name}} </address> ]]> </viewer>
				<editor x-show-titles="false">
					<field name="street" colSpan="12" />
					<field name="area" colSpan="12" />
					<field name="city" colSpan="12" />
					<field name="state" colSpan="6" />
					<field name="zip" colSpan="6" />
				</editor>
			</field>
		</panel>
		<panel title="Companies">
			<field name="company" widget="TagSelect"
				form-view="company-grid" colSpan="12">
			</field>
		</panel>
		<panel sidebar="true">
			<field name="agreementPeriod"
				selection="agreementPeriod-selection-list"></field>
		</panel>
		<panel sidebar="true">
			<field name="startdate" onChange="validate-startdate"></field>
		</panel>
	</form>

	<action-view name="partner.showallpartner.tree"
		title="Patners" model="com.axelor.partner.db.Partner">
		<view type="grid" name="partner-grid" />
		<view type="form" name="partner-form" />
		<domain>self.id = :partner_id</domain>
		<context name="partner_id" expr="eval: id" />
		<context name="_showSingle" expr="true" />
	</action-view>

	<action-view name="partner.showalladdress.tree"
		title="Address" model="com.axelor.partner.db.Address">
		<view type="grid" name="address-grid" />
		<view type="form" name="address-form" />
		<domain>self.id = :project_id</domain>
		<context name="project_id" expr="eval: id" />
		<context name="_showSingle" expr="true" />
	</action-view>

	<action-record name="default-fname"
		model="com.axelor.partner.db.Partner">
		<field name="firstName" expr="aaaa" />
	</action-record>

	<action-group name="action-group-onsave">
		<action name="alert-valid-action" />
		<action name="default-email" />
		<action name="action-setcompanyassociations" if="company!=null" />
	</action-group>

	<action-attrs name="action-export-on">
		<attribute for="btexport" name="readonly" expr="false" />
	</action-attrs>

	<action-validate name="alert-valid-action">
		<alert
			message="Company is not associated. Are you sure to register?"
			if="company.size() == 0" />
		<alert
			message="Image in not uploaded. Do you still wanna proceed?"
			if="!image" />
		<!-- <alert message="Email is not set. Default email will be automatically 
			be assigned" if="!email" /> -->
		<!-- <alert message="No adddress is specified. Do you want to proceed?" 
			if="!addresses"/> -->
	</action-validate>

	<action-method name="action-setcompanyassociations">
		<call class="com.axelor.partner.web.DefaultValueClass"
			method="setCompanyAssociationsCount" />
	</action-method>

	<action-method name="default-email">
		<call class="com.axelor.partner.web.DefaultValueClass"
			method="setDefaultEmail" />
	</action-method>

	<action-attrs name="action-attr-lname-readonly-false">
		<attribute for="lastName" name="readonly" expr="false" />
	</action-attrs>

	<action-validate name="validate-startdate">
		<error message="Start date can not be in future."
			if="startdate &gt; __date__" action="set-default-date" />
	</action-validate>

	<action-attrs name="set-default-date">
		<attribute name="value" for="startdate"
			expr="eval: __date__" />
	</action-attrs>

	<action-method name="action-export-csv">
		<call class="com.axelor.partner.web.DefaultValueClass"
			method="exportPatner" />
	</action-method>

	<action-export name="action-export-xml"
		output="${fullName}-${date}">
		<export name="${fullName}.xml"
			template="data-export/exort-partner-groovy.tmpl" engine="groovy" />
	</action-export>

	<action-method name="action-set-parameter">
		<call class="com.axelor.partner.web.DefaultValueClass"
			method="setReportParams" />
	</action-method>

	<action-report output="Partner"
		name="action-show-partner" design="partner.rptdesign">
		<param name="ids" expr="eval: id" />
		<param name="Attachments" expr="eval: Attachments" />
	</action-report>

	<action-report output="Partners"
		name="action-show-partners" design="partners.rptdesign">
		<param name="ids" expr="eval: _ids.join(',') " />
		<param name="locale" expr="locale"/>
	</action-report>
</object-views>
