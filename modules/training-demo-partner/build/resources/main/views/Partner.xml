<?xml version="1.0" encoding="UTF-8"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_5.0.xsd">

	<cards name="partner-card" model="com.axelor.partner.db.Partner"
		title="Partners">
		<field name="fullName" />
		<field name="email" />
		<field name="address" />
		<field name="hasImage" />
		<template><![CDATA[
      <div class="span4 card-image">
        <img ng-if="hasImage" ng-src="{{$image(null, 'image')}}">
        <img ng-if="!hasImage" src="img/user.png">
        <strong>{{fullName}}</strong><br>
      </div>
      <div class="span8">
        <address>
			{{address.street}} {{address.area}}<br>
        	{{address.city}}<span ng-if="address.state">, {{address.state}}</span><br>
        	<span ng-if="address.zip">{{address.zip}}<br></span>
        	<abbr ng-if="email" title="Email">E:</abbr> {{email.emailId}}<br>
        </address>
      </div>
    ]]></template>
	</cards>

	<kanban name="partner-kanban" sequenceBy="companyassociations"
		model="com.axelor.partner.db.Partner" columnBy="agreementPeriod"
		title="Partners" limit="5">
		<field name="fullName" />
		<field name="hasImage" />
		<field name="startdate" />
		<field name="seeCompany" />
		<hilite color="success" if="seeCompany>=5" />
		<hilite color="danger" if="seeCompany==0" />
		<hilite color="danger" if="seeCompany>2" />
		<hilite color="info" if="seeCompany>=1" />

		<template><![CDATA[
			<h4>{{fullName}}</h4>
    		{{seeCompany}}
    		<img ng-if="hasImage" ng-src="{{$image(null, 'image')}}">
        	<img ng-if="!hasImage" src="img/user.png">
    		<div class="card-footer">
      			<i class='fa fa-clock-o'></i> <span>{{startdate}}</span>
    		</div>
		]]></template>
	</kanban>

	<selection name="agreementPeriod-selection-list">
		<option value="5">5 Years</option>
		<option value="10">10 Years</option>
		<option value="15">15 Years</option>
	</selection>

	<form model="com.axelor.partner.db.Partner" title="Partner"
		name="partner-form" onSave="action-group-onsave"
		onNew="default-fname,action-attr-lname-readonly-false">
		<panel sidebar="true" colSpan="4" title="Photo">
			<field name="image" showTitle="false" colSpan="12" />
		</panel>

		<panel title="Personal">
			<field name="fullName" title="Name" readonly="false"
				colSpan="12">
				<editor x-show-titles="false">
					<field name="firstName" colSpan="5" />
					<field name="lastName" colSpan="5" readonly="true" />
				</editor>
			</field>
		</panel>

		<panel title="Contacts">
			<field name="email" canSelect="false">
				<editor layout="table"><!-- x-show-titles="false" -->
					<field name="emailId" />
				</editor>
			</field>
			<field name="addresses" colSpan="12" css="address-list">
				<viewer><![CDATA[ <address> {{record.street}} {{record.area}}<br> {{record.city}}, {{record.state}} 
										- {{record.zip}}<br> {{record.country.name}} </address> ]]> </viewer>
				<editor x-show-titles="false">
					<field name="street" colSpan="12" />
					<field name="area" colSpan="12" />
					<field name="city" colSpan="12" />
					<field name="state" colSpan="6" />
					<field name="zip" colSpan="6" />
				</editor>
			</field>
		</panel>
		<panel title="Companies">
			<field name="company" widget="TagSelect"
				form-view="company-grid" colSpan="12">
			</field>
		</panel>
		<panel sidebar="true">
			<field name="agreementPeriod"
				selection="agreementPeriod-selection-list"></field>
		</panel>
		<panel sidebar="true">
			<field name="startdate" onChange="validate-startdate"></field>
		</panel>
	</form>

	<action-record name="default-fname"
		model="com.axelor.partner.db.Partner">
		<field name="firstName" expr="aaaa" />
	</action-record>

	<action-group name="action-group-onsave">
		<action name="alert-valid-action" />
		<action name="action-show-patner-guice" />
		<action name="default-email" />
		<action name="action-setcompanyassociations" />
	</action-group>

	<action-validate name="alert-valid-action">
		<alert
			message="Company is not associated. Are you sure to register?"
			if="company.size() == 0" />
		<alert
			message="Image in not uploaded. Do you still wanna proceed?"
			if="!image" />
		<!-- <alert message="Email is not set. Default email will be automatically 
			be assigned" if="!email" /> -->
		<!-- <alert message="No adddress is specified. Do you want to proceed?" 
			if="!addresses"/> -->
	</action-validate>

	<action-method name="action-setcompanyassociations">
		<call class="com.axelor.partner.web.DefaultValueClass"
			method="setCompanyAssociationsCount" />
	</action-method>

	<action-method name="default-email">
		<call class="com.axelor.partner.web.DefaultValueClass"
			method="setDefaultEmail" />
	</action-method>

	<action-method name="action-show-patner-guice">
		<call class="com.axelor.partner.web.DefaultValueClass"
			method="show" />
	</action-method>

	<action-attrs name="action-attr-lname-readonly-false">
		<attribute for="lastName" name="readonly" expr="false" />
	</action-attrs>

	<action-validate name="validate-startdate">
		<error message="Start date can not be in future."
			if="startdate &gt; __date__" action="set-default-date" />
	</action-validate>

	<action-attrs name="set-default-date">
		<attribute name="value" for="startdate"
			expr="eval: __date__" />
	</action-attrs>
	<!-- <action-script name="set-default-date" model="com.axelor.partner.db.Partner"> 
		<script language="js"> <![CDATA[[ var req = $request; var res = $response; 
		res.setValue('startdate', __date__); ]]> </script> </action-script> -->
</object-views>
